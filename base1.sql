CREATE DATABASE  IF NOT EXISTS `energia_db` /*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci */ /*!80016 DEFAULT ENCRYPTION='N' */;
USE `energia_db`;
-- MySQL dump 10.13  Distrib 8.0.43, for Win64 (x86_64)
--
-- Host: 127.0.0.1    Database: energia_db
-- ------------------------------------------------------
-- Server version	9.1.0

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!50503 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `alertas`
--

DROP TABLE IF EXISTS `alertas`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `alertas` (
  `id` int NOT NULL AUTO_INCREMENT,
  `id_circuito` int NOT NULL,
  `timestamp` datetime NOT NULL,
  `tipo_alerta` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL,
  `valor_registrado` float DEFAULT NULL,
  `mensaje` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `estado` enum('Nueva','Vista','Resuelta') COLLATE utf8mb4_unicode_ci DEFAULT 'Nueva',
  PRIMARY KEY (`id`),
  KEY `id_circuito` (`id_circuito`),
  CONSTRAINT `alertas_ibfk_1` FOREIGN KEY (`id_circuito`) REFERENCES `circuitos` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `alertas`
--

LOCK TABLES `alertas` WRITE;
/*!40000 ALTER TABLE `alertas` DISABLE KEYS */;
/*!40000 ALTER TABLE `alertas` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `circuitos`
--

DROP TABLE IF EXISTS `circuitos`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `circuitos` (
  `id` int NOT NULL AUTO_INCREMENT,
  `id_sucursal` int NOT NULL,
  `nombre` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL,
  `descripcion` text COLLATE utf8mb4_unicode_ci,
  `identificador_hardware` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `umbral_alerta_w` int DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `id_sucursal` (`id_sucursal`),
  CONSTRAINT `circuitos_ibfk_1` FOREIGN KEY (`id_sucursal`) REFERENCES `sucursales` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `circuitos`
--

LOCK TABLES `circuitos` WRITE;
/*!40000 ALTER TABLE `circuitos` DISABLE KEYS */;
INSERT INTO `circuitos` VALUES (1,1,'Consumo Total Simulado','Medición general para pruebas de software',NULL,NULL);
/*!40000 ALTER TABLE `circuitos` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `lecturas`
--

DROP TABLE IF EXISTS `lecturas`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `lecturas` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `id_circuito` int NOT NULL,
  `fecha` datetime(3) NOT NULL,
  `potencia_w` float NOT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_circuito_timestamp` (`id_circuito`,`fecha`),
  CONSTRAINT `lecturas_ibfk_1` FOREIGN KEY (`id_circuito`) REFERENCES `circuitos` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=530 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `lecturas`
--

LOCK TABLES `lecturas` WRITE;
/*!40000 ALTER TABLE `lecturas` DISABLE KEYS */;
INSERT INTO `lecturas` VALUES (1,1,'2025-11-05 08:44:14.057',443465),(2,1,'2025-11-05 08:44:24.099',333552),(3,1,'2025-11-05 08:44:34.149',337522),(4,1,'2025-11-05 08:44:44.193',306821),(5,1,'2025-11-05 08:44:54.244',351715),(6,1,'2025-11-05 08:45:04.294',340318),(7,1,'2025-11-05 08:45:14.341',330196),(8,1,'2025-11-05 08:45:24.400',496128),(9,1,'2025-11-05 08:45:46.840',367323),(10,1,'2025-11-05 08:45:56.889',321583),(11,1,'2025-11-05 08:46:06.945',486285),(12,1,'2025-11-05 08:46:26.225',277607),(13,1,'2025-11-05 08:46:36.355',380779),(14,1,'2025-11-05 08:46:46.399',306209),(15,1,'2025-11-05 08:46:56.454',221605),(16,1,'2025-11-05 08:47:06.582',467906),(17,1,'2025-11-05 08:47:16.627',383896),(18,1,'2025-11-05 08:47:26.670',100),(19,1,'2025-11-05 08:47:36.774',420569),(20,1,'2025-11-05 08:47:46.816',201678),(21,1,'2025-11-05 08:47:56.855',194594),(22,1,'2025-11-05 08:48:06.897',169866),(23,1,'2025-11-05 08:48:16.943',176085),(24,1,'2025-11-05 08:48:26.989',458109),(25,1,'2025-11-05 08:48:37.016',229759),(26,1,'2025-11-05 08:48:47.056',331269),(27,1,'2025-11-05 08:48:57.114',150734),(28,1,'2025-11-05 08:49:07.164',211150),(29,1,'2025-11-05 08:49:17.210',379016),(30,1,'2025-11-05 08:49:27.257',437561),(31,1,'2025-11-05 08:49:37.307',359676),(32,1,'2025-11-05 08:49:47.348',329445),(33,1,'2025-11-05 08:49:57.389',160069),(34,1,'2025-11-05 08:50:07.431',429484),(35,1,'2025-11-05 08:50:17.476',409237),(36,1,'2025-11-05 08:50:27.517',238713),(37,1,'2025-11-05 08:50:37.575',443201),(38,1,'2025-11-05 08:50:47.653',221827),(39,1,'2025-11-05 08:50:57.708',225452),(40,1,'2025-11-05 08:51:07.754',394085),(41,1,'2025-11-05 08:51:17.796',447081),(42,1,'2025-11-05 08:51:27.841',482126),(43,1,'2025-11-06 19:11:13.100',186565),(44,1,'2025-11-06 19:11:23.253',404444),(45,1,'2025-11-06 19:11:33.309',398400),(46,1,'2025-11-06 19:11:43.366',227510),(47,1,'2025-11-06 19:11:53.431',307177),(48,1,'2025-11-06 19:12:03.483',471906),(49,1,'2025-11-06 19:12:13.518',175889),(50,1,'2025-11-06 19:12:23.552',397015),(51,1,'2025-11-06 19:12:33.769',336074),(52,1,'2025-11-06 19:12:43.839',391050),(53,1,'2025-11-06 19:12:53.891',166167),(54,1,'2025-11-06 19:13:03.918',336117),(55,1,'2025-11-06 19:13:13.965',217565),(56,1,'2025-11-06 19:13:24.021',495622),(57,1,'2025-11-06 19:13:37.781',255849),(58,1,'2025-11-06 19:13:47.849',416970),(59,1,'2025-11-06 19:13:57.892',158946),(60,1,'2025-11-06 19:14:07.911',254706),(61,1,'2025-11-06 19:14:17.930',152058),(62,1,'2025-11-06 19:14:27.964',196215),(63,1,'2025-11-06 19:14:37.984',402735),(64,1,'2025-11-06 19:14:48.020',477898),(65,1,'2025-11-06 19:14:58.054',355622),(66,1,'2025-11-06 19:15:08.075',181899),(67,1,'2025-11-06 19:15:18.107',399756),(68,1,'2025-11-06 19:15:28.139',245634),(69,1,'2025-11-06 19:15:38.171',226341),(70,1,'2025-11-06 19:15:48.203',300671),(71,1,'2025-11-06 19:15:58.236',493789),(72,1,'2025-11-06 19:16:11.884',294150),(73,1,'2025-11-06 19:16:21.919',432651),(74,1,'2025-11-06 19:16:31.953',284813),(75,1,'2025-11-06 19:16:41.989',405143),(76,1,'2025-11-06 19:16:52.021',243480),(77,1,'2025-11-06 19:17:02.034',335498),(78,1,'2025-11-06 19:17:12.071',323180),(79,1,'2025-11-06 19:17:22.110',466878),(80,1,'2025-11-06 19:17:32.148',293885),(81,1,'2025-11-06 19:17:42.166',309858),(82,1,'2025-11-06 19:17:52.196',341847),(83,1,'2025-11-06 19:18:02.230',303804),(84,1,'2025-11-06 19:18:12.311',307926),(85,1,'2025-11-06 19:18:22.421',378724),(86,1,'2025-11-06 19:18:32.442',292161),(87,1,'2025-11-06 19:18:42.457',404630),(88,1,'2025-11-06 19:18:52.487',327153),(89,1,'2025-11-06 19:19:02.591',444643),(90,1,'2025-11-06 19:19:12.603',182121),(91,1,'2025-11-06 19:19:22.629',212440),(92,1,'2025-11-06 19:19:32.642',478716),(93,1,'2025-11-06 19:19:42.655',186022),(94,1,'2025-11-06 19:19:52.749',208514),(95,1,'2025-11-06 19:20:02.795',464945),(96,1,'2025-11-06 19:20:12.817',264196),(97,1,'2025-11-06 19:20:22.853',414151),(98,1,'2025-11-06 19:20:32.886',480038),(99,1,'2025-11-06 19:20:46.528',382441),(100,1,'2025-11-06 19:20:56.562',372844),(101,1,'2025-11-06 19:21:06.579',346211),(102,1,'2025-11-06 19:21:16.613',465377),(103,1,'2025-11-06 19:21:26.628',356888),(104,1,'2025-11-06 19:21:36.646',317216),(105,1,'2025-11-06 19:21:46.659',241073),(106,1,'2025-11-06 19:21:56.677',345076),(107,1,'2025-11-06 19:22:06.693',192259),(108,1,'2025-11-06 19:22:16.722',494050),(109,1,'2025-11-06 19:22:29.656',310018),(110,1,'2025-11-06 19:22:39.695',167343),(111,1,'2025-11-06 19:22:49.711',201364),(112,1,'2025-11-06 19:22:59.741',362664),(113,1,'2025-11-06 19:23:09.758',491826),(114,1,'2025-11-06 19:23:22.321',150655),(115,1,'2025-11-19 18:50:08.261',179859),(116,1,'2025-11-19 18:50:18.354',220688),(117,1,'2025-11-19 18:50:28.371',264193),(118,1,'2025-11-19 18:50:38.402',178656),(119,1,'2025-11-19 18:50:48.416',449330),(120,1,'2025-11-19 18:50:58.442',214660),(121,1,'2025-11-19 18:51:08.460',241412),(122,1,'2025-11-19 18:51:18.569',366934),(123,1,'2025-11-19 18:51:28.596',179283),(124,1,'2025-11-19 18:51:38.640',210979),(125,1,'2025-11-19 18:51:48.657',484774),(126,1,'2025-11-19 18:52:02.904',170181),(127,1,'2025-11-19 18:52:12.918',339839),(128,1,'2025-11-19 18:52:22.936',198197),(129,1,'2025-11-19 18:52:32.968',268478),(130,1,'2025-11-27 10:47:51.428',361895),(131,1,'2025-11-27 10:48:01.474',254699),(132,1,'2025-11-27 10:48:11.506',426853),(133,1,'2025-11-27 10:48:21.517',499911),(134,1,'2025-11-27 10:48:35.300',409640),(135,1,'2025-11-27 10:48:45.327',405987),(136,1,'2025-11-27 10:48:55.356',198924),(137,1,'2025-11-27 10:49:05.368',463054),(138,1,'2025-11-27 10:49:15.399',423127),(139,1,'2025-11-27 10:49:25.414',417423),(140,1,'2025-11-27 10:49:35.447',297256),(141,1,'2025-11-27 10:49:45.469',249855),(142,1,'2025-11-27 10:49:55.482',281737),(143,1,'2025-11-27 10:50:05.503',325934),(144,1,'2025-11-27 10:50:15.538',499901),(145,1,'2025-11-27 17:50:37.635',475564),(146,1,'2025-11-27 17:50:47.677',354184),(147,1,'2025-11-27 17:50:57.700',415290),(148,1,'2025-11-27 17:51:07.713',252737),(149,1,'2025-11-27 17:51:17.749',209150),(150,1,'2025-11-27 17:51:27.781',313282),(151,1,'2025-11-27 17:51:37.800',487973),(152,1,'2025-11-27 17:51:52.757',335989),(153,1,'2025-11-27 17:52:02.800',169117),(154,1,'2025-11-27 17:52:12.841',329150),(155,1,'2025-11-27 17:52:22.878',272034),(156,1,'2025-11-27 17:52:32.909',248709),(157,1,'2025-11-27 17:52:42.925',155914),(158,1,'2025-11-27 17:52:52.953',336626),(159,1,'2025-11-27 17:53:02.977',247138),(160,1,'2025-11-27 17:53:13.011',433986),(161,1,'2025-11-27 17:53:23.027',234899),(162,1,'2025-11-27 17:53:33.088',374376),(163,1,'2025-11-27 17:53:43.301',387998),(164,1,'2025-11-27 17:53:53.360',299011),(165,1,'2025-11-27 17:54:03.420',278901),(166,1,'2025-11-27 17:54:13.618',157126),(167,1,'2025-11-27 17:54:23.754',338587),(168,1,'2025-11-27 17:54:33.787',336745),(169,1,'2025-11-27 17:54:43.825',409214),(170,1,'2025-11-27 17:54:53.856',346057),(171,1,'2025-11-27 17:55:03.891',194489),(172,1,'2025-11-27 17:55:13.960',375542),(173,1,'2025-11-27 17:55:23.987',377337),(174,1,'2025-11-27 17:55:34.008',422751),(175,1,'2025-11-27 17:55:44.051',296492),(176,1,'2025-11-30 18:08:24.917',293834),(177,1,'2025-11-30 18:08:34.969',255658),(178,1,'2025-11-30 18:08:44.996',305971),(179,1,'2025-11-30 18:08:55.020',369789),(180,1,'2025-11-30 18:09:05.058',186470),(181,1,'2025-11-30 18:09:15.087',486825),(182,1,'2025-11-30 20:43:09.397',415257),(183,1,'2025-11-30 20:43:19.415',280334),(184,1,'2025-11-30 20:43:29.441',196222),(185,1,'2025-11-30 20:43:39.481',265808),(186,1,'2025-11-30 20:43:49.525',351075),(187,1,'2025-11-30 20:49:22.547',466300),(188,1,'2025-11-30 20:49:32.568',335463),(189,1,'2025-11-30 20:49:42.585',372186),(190,1,'2025-11-30 20:49:52.628',225319),(191,1,'2025-11-30 20:50:02.648',346397),(192,1,'2025-11-30 20:50:12.690',411182),(193,1,'2025-11-30 20:50:22.736',355348),(194,1,'2025-11-30 20:50:32.772',201770),(195,1,'2025-11-30 20:50:42.789',372224),(196,1,'2025-11-30 20:50:52.827',391176),(197,1,'2025-11-30 23:04:23.207',445452),(198,1,'2025-11-30 23:04:33.242',339825),(199,1,'2025-11-30 23:04:43.291',225549),(200,1,'2025-11-30 23:04:53.318',372297),(201,1,'2025-11-30 23:05:03.367',189421),(202,1,'2025-11-30 23:05:13.401',229345),(203,1,'2025-11-30 23:05:23.464',355941),(204,1,'2025-11-30 23:05:33.495',430646),(205,1,'2025-11-30 23:05:43.536',348669),(206,1,'2025-11-30 23:05:53.610',453650),(207,1,'2025-11-30 23:06:03.679',307774),(208,1,'2025-11-30 23:06:13.728',225133),(209,1,'2025-11-30 23:06:23.777',369388),(210,1,'2025-11-30 23:06:33.826',387886),(211,1,'2025-11-30 23:06:43.883',181055),(212,1,'2025-11-30 23:06:53.928',243046),(213,1,'2025-11-30 23:07:03.959',249096),(214,1,'2025-11-30 23:07:14.007',338050),(215,1,'2025-11-30 23:07:24.042',459822),(216,1,'2025-11-30 23:07:34.091',412491),(217,1,'2025-11-30 23:07:44.131',240730),(218,1,'2025-11-30 23:07:54.174',394505),(219,1,'2025-11-30 23:08:04.243',369317),(220,1,'2025-11-30 23:08:14.299',430665),(221,1,'2025-11-30 23:08:24.341',380053),(222,1,'2025-11-30 23:08:34.397',400513),(223,1,'2025-11-30 23:08:44.441',289364),(224,1,'2025-11-30 23:08:54.487',302597),(225,1,'2025-11-30 23:09:04.537',175393),(226,1,'2025-11-30 23:09:14.581',391766),(227,1,'2025-11-30 23:09:24.628',380871),(228,1,'2025-11-30 23:09:34.683',323502),(229,1,'2025-11-30 23:09:44.728',236516),(230,1,'2025-11-30 23:09:54.778',430555),(231,1,'2025-11-30 23:10:04.827',188235),(232,1,'2025-11-30 23:10:14.876',396446),(233,1,'2025-11-30 23:10:24.938',426571),(234,1,'2025-11-30 23:10:34.985',401334),(235,1,'2025-11-30 23:10:45.050',465745),(236,1,'2025-11-30 23:10:55.116',330156),(237,1,'2025-11-30 23:11:05.166',491295),(238,1,'2025-11-30 23:11:19.563',220497),(239,1,'2025-11-30 23:11:29.596',289432),(240,1,'2025-11-30 23:11:39.655',250859),(241,1,'2025-11-30 23:11:49.730',385580),(242,1,'2025-11-30 23:11:59.782',279043),(243,1,'2025-11-30 23:12:09.829',179698),(244,1,'2025-11-30 23:12:19.857',345651),(245,1,'2025-11-30 23:12:29.912',205522),(246,1,'2025-11-30 23:12:39.959',211692),(247,1,'2025-11-30 23:12:50.005',481433),(248,1,'2025-11-30 23:13:03.204',364987),(249,1,'2025-11-30 23:13:13.272',399147),(250,1,'2025-11-30 23:13:23.324',394744),(251,1,'2025-11-30 23:13:33.385',297176),(252,1,'2025-11-30 23:13:43.448',251819),(253,1,'2025-11-30 23:13:53.492',237686),(254,1,'2025-11-30 23:14:03.519',229012),(255,1,'2025-11-30 23:14:13.570',321513),(256,1,'2025-11-30 23:14:23.614',189520),(257,1,'2025-11-30 23:14:33.657',289286),(258,1,'2025-11-30 23:14:43.716',435734),(259,1,'2025-11-30 23:14:53.767',389329),(260,1,'2025-11-30 23:15:03.797',198006),(261,1,'2025-11-30 23:15:13.848',406839),(262,1,'2025-11-30 23:15:23.876',298784),(263,1,'2025-11-30 23:15:33.925',278547),(264,1,'2025-11-30 23:15:43.970',349893),(265,1,'2025-11-30 23:15:54.015',435151),(266,1,'2025-11-30 23:16:04.062',357915),(267,1,'2025-11-30 23:16:14.088',478391),(268,1,'2025-11-30 23:16:24.138',412711),(269,1,'2025-11-30 23:16:34.171',344471),(270,1,'2025-11-30 23:16:44.206',401131),(271,1,'2025-11-30 23:16:54.277',219790),(272,1,'2025-11-30 23:17:04.308',261262),(273,1,'2025-11-30 23:17:14.353',401526),(274,1,'2025-11-30 23:17:24.384',435048),(275,1,'2025-11-30 23:17:34.424',377840),(276,1,'2025-11-30 23:17:44.453',177581),(277,1,'2025-11-30 23:17:54.482',248989),(278,1,'2025-11-30 23:18:04.537',443844),(279,1,'2025-11-30 23:18:14.588',490951),(280,1,'2025-11-30 23:18:28.108',424906),(281,1,'2025-11-30 23:18:38.158',153240),(282,1,'2025-11-30 23:18:48.202',277372),(283,1,'2025-11-30 23:18:58.228',157971),(284,1,'2025-11-30 23:19:08.271',244729),(285,1,'2025-11-30 23:19:18.291',234984),(286,1,'2025-11-30 23:19:28.324',218775),(287,1,'2025-11-30 23:19:38.367',322046),(288,1,'2025-11-30 23:19:48.414',245208),(289,1,'2025-11-30 23:19:58.439',252654),(290,1,'2025-11-30 23:20:08.482',300578),(291,1,'2025-11-30 23:20:18.513',223919),(292,1,'2025-11-30 23:20:28.543',201219),(293,1,'2025-11-30 23:20:38.582',481835),(294,1,'2025-11-30 23:20:51.772',308566),(295,1,'2025-11-30 23:21:01.824',245683),(296,1,'2025-11-30 23:21:11.870',223073),(297,1,'2025-11-30 23:21:21.912',281378),(298,1,'2025-11-30 23:21:31.947',187820),(299,1,'2025-11-30 23:21:41.991',305285),(300,1,'2025-11-30 23:21:52.030',481769),(301,1,'2025-11-30 23:22:05.605',457298),(302,1,'2025-11-30 23:22:15.654',452199),(303,1,'2025-11-30 23:22:25.707',412109),(304,1,'2025-11-30 23:22:35.756',345157),(305,1,'2025-11-30 23:22:45.804',218387),(306,1,'2025-11-30 23:22:55.855',353644),(307,1,'2025-11-30 23:23:05.902',259157),(308,1,'2025-11-30 23:23:15.957',324408),(309,1,'2025-11-30 23:23:26.008',353497),(310,1,'2025-11-30 23:23:36.050',451762),(311,1,'2025-11-30 23:23:46.092',411126),(312,1,'2025-11-30 23:23:56.115',365619),(313,1,'2025-11-30 23:24:06.136',461134),(314,1,'2025-11-30 23:24:16.164',401392),(315,1,'2025-11-30 23:24:26.200',486500),(316,1,'2025-11-30 23:24:39.614',186112),(317,1,'2025-11-30 23:36:31.835',175477),(318,1,'2025-11-30 23:36:41.863',490473),(319,1,'2025-11-30 23:36:55.063',395228),(320,1,'2025-11-30 23:37:05.100',165547),(321,1,'2025-11-30 23:37:15.140',237345),(322,1,'2025-11-30 23:37:25.182',399539),(323,1,'2025-11-30 23:37:35.211',452037),(324,1,'2025-11-30 23:37:45.254',473222),(325,1,'2025-11-30 23:37:55.301',451054),(326,1,'2025-11-30 23:38:05.351',397688),(327,1,'2025-11-30 23:38:15.395',209277),(328,1,'2025-11-30 23:38:25.437',424988),(329,1,'2025-11-30 23:38:35.459',299866),(330,1,'2025-11-30 23:38:45.504',439055),(331,1,'2025-11-30 23:38:55.545',417445),(332,1,'2025-11-30 23:39:05.591',165207),(333,1,'2025-11-30 23:39:15.630',313762),(334,1,'2025-11-30 23:39:25.671',190178),(335,1,'2025-11-30 23:39:35.720',429192),(336,1,'2025-11-30 23:39:45.764',197519),(337,1,'2025-11-30 23:39:55.790',168772),(338,1,'2025-11-30 23:40:05.834',358890),(339,1,'2025-11-30 23:40:15.875',169626),(340,1,'2025-11-30 23:40:25.915',465075),(341,1,'2025-11-30 23:40:35.962',344280),(342,1,'2025-11-30 23:40:45.988',367598),(343,1,'2025-11-30 23:40:56.034',334116),(344,1,'2025-11-30 23:41:06.068',274726),(345,1,'2025-11-30 23:41:16.113',326993),(346,1,'2025-11-30 23:41:26.136',190307),(347,1,'2025-11-30 23:41:36.180',450454),(348,1,'2025-11-30 23:41:46.222',230141),(349,1,'2025-11-30 23:41:56.249',416505),(350,1,'2025-11-30 23:42:06.296',311208),(351,1,'2025-11-30 23:42:16.334',395015),(352,1,'2025-11-30 23:42:26.375',191724),(353,1,'2025-11-30 23:42:36.425',175722),(354,1,'2025-11-30 23:42:46.480',417846),(355,1,'2025-11-30 23:42:56.528',489830),(356,1,'2025-11-30 23:43:09.644',177260),(357,1,'2025-11-30 23:43:19.668',408132),(358,1,'2025-11-30 23:43:29.712',379006),(359,1,'2025-11-30 23:43:39.755',379365),(360,1,'2025-11-30 23:43:49.802',360792),(361,1,'2025-11-30 23:43:59.846',394570),(362,1,'2025-11-30 23:44:09.904',231056),(363,1,'2025-11-30 23:44:19.952',463111),(364,1,'2025-11-30 23:44:29.983',391651),(365,1,'2025-11-30 23:44:40.024',278603),(366,1,'2025-11-30 23:44:50.064',365527),(367,1,'2025-11-30 23:45:00.096',321412),(368,1,'2025-11-30 23:45:10.172',300468),(369,1,'2025-11-30 23:45:20.195',281800),(370,1,'2025-11-30 23:45:30.238',163889),(371,1,'2025-11-30 23:45:40.299',357079),(372,1,'2025-11-30 23:45:50.338',439330),(373,1,'2025-11-30 23:46:00.382',344201),(374,1,'2025-11-30 23:46:10.428',229101),(375,1,'2025-11-30 23:46:20.450',476581),(376,1,'2025-11-30 23:46:30.570',384531),(377,1,'2025-11-30 23:46:40.607',347548),(378,1,'2025-11-30 23:46:50.648',165937),(379,1,'2025-11-30 23:47:00.689',204153),(380,1,'2025-11-30 23:47:10.728',345962),(381,1,'2025-11-30 23:47:20.751',156103),(382,1,'2025-11-30 23:47:30.790',348289),(383,1,'2025-11-30 23:47:40.827',333393),(384,1,'2025-11-30 23:47:50.865',425864),(385,1,'2025-11-30 23:48:00.905',253608),(386,1,'2025-11-30 23:48:10.930',477189),(387,1,'2025-11-30 23:48:20.974',386492),(388,1,'2025-11-30 23:48:31.000',358534),(389,1,'2025-11-30 23:48:41.053',412504),(390,1,'2025-11-30 23:48:51.078',184782),(391,1,'2025-11-30 23:49:01.125',273163),(392,1,'2025-11-30 23:49:11.170',199888),(393,1,'2025-11-30 23:49:21.196',390715),(394,1,'2025-11-30 23:49:31.239',283156),(395,1,'2025-11-30 23:49:41.281',356125),(396,1,'2025-11-30 23:49:51.330',414332),(397,1,'2025-11-30 23:50:01.362',474544),(398,1,'2025-11-30 23:50:11.418',405853),(399,1,'2025-11-30 23:50:21.459',312789),(400,1,'2025-11-30 23:50:31.501',452692),(401,1,'2025-11-30 23:50:41.549',299664),(402,1,'2025-11-30 23:50:51.587',158346),(403,1,'2025-11-30 23:51:01.611',166338),(404,1,'2025-12-01 09:28:26.998',302354),(405,1,'2025-12-01 09:28:37.025',381234),(406,1,'2025-12-01 09:28:47.035',341813),(407,1,'2025-12-01 09:28:57.066',415550),(408,1,'2025-12-01 09:29:07.083',177450),(409,1,'2025-12-01 09:29:17.106',265910),(410,1,'2025-12-01 09:29:27.145',468264),(411,1,'2025-12-01 09:29:37.469',213201),(412,1,'2025-12-01 09:29:47.496',469199),(413,1,'2025-12-01 09:29:57.539',296736),(414,1,'2025-12-01 09:30:07.561',229964),(415,1,'2025-12-01 09:30:17.586',385280),(416,1,'2025-12-02 16:46:16.264',215227),(417,1,'2025-12-02 16:46:26.379',244435),(418,1,'2025-12-02 16:46:36.403',233458),(419,1,'2025-12-02 16:46:46.426',300332),(420,1,'2025-12-02 16:46:56.472',417550),(421,1,'2025-12-02 16:47:06.517',383223),(422,1,'2025-12-02 16:47:16.544',496126),(423,1,'2025-12-02 16:47:30.567',175862),(424,1,'2025-12-02 16:47:40.606',166902),(425,1,'2025-12-02 16:47:50.643',409419),(426,1,'2025-12-02 16:48:00.689',495972),(427,1,'2025-12-02 16:48:19.062',384564),(428,1,'2025-12-02 16:48:29.109',348196),(429,1,'2025-12-02 16:48:39.157',410902),(430,1,'2025-12-02 16:48:49.210',172153),(431,1,'2025-12-02 16:48:59.257',423385),(432,1,'2025-12-02 16:49:09.283',190556),(433,1,'2025-12-02 16:49:19.324',324748),(434,1,'2025-12-02 16:49:29.366',212739),(435,1,'2025-12-02 16:49:39.405',323848),(436,1,'2025-12-02 16:49:49.433',193950),(437,1,'2025-12-02 16:49:59.476',384752),(438,1,'2025-12-02 16:50:09.528',339571),(439,1,'2025-12-02 16:50:19.563',394914),(440,1,'2025-12-02 16:50:29.611',319259),(441,1,'2025-12-02 16:50:39.656',361294),(442,1,'2025-12-02 16:50:49.680',479804),(443,1,'2025-12-02 16:50:59.723',383204),(444,1,'2025-12-02 16:51:09.786',441392),(445,1,'2025-12-02 16:51:19.812',433289),(446,1,'2025-12-02 16:51:29.837',184972),(447,1,'2025-12-02 16:51:39.861',390661),(448,1,'2025-12-02 16:51:49.892',235575),(449,1,'2025-12-02 16:51:59.915',232797),(450,1,'2025-12-02 16:52:09.943',151424),(451,1,'2025-12-02 16:52:19.987',406688),(452,1,'2025-12-02 16:52:30.016',190045),(453,1,'2025-12-02 16:52:40.059',319911),(454,1,'2025-12-02 16:52:50.097',199061),(455,1,'2025-12-02 17:07:10.643',319196),(456,1,'2025-12-02 17:07:20.686',414811),(457,1,'2025-12-02 17:07:30.714',197036),(458,1,'2025-12-02 17:07:40.738',281422),(459,1,'2025-12-02 17:07:50.760',445639),(460,1,'2025-12-02 17:08:00.802',323006),(461,1,'2025-12-02 17:08:10.850',222021),(462,1,'2025-12-02 17:08:20.889',409670),(463,1,'2025-12-02 17:08:30.938',397706),(464,1,'2025-12-02 17:08:40.983',446705),(465,1,'2025-12-02 17:08:51.029',158307),(466,1,'2025-12-02 17:09:01.074',462599),(467,1,'2025-12-02 17:09:11.118',269542),(468,1,'2025-12-02 17:09:21.142',156324),(469,1,'2025-12-02 17:09:31.175',197089),(470,1,'2025-12-02 17:09:41.209',266351),(471,1,'2025-12-02 17:09:51.244',241072),(472,1,'2025-12-02 17:10:01.291',473555),(473,1,'2025-12-02 17:10:11.323',371465),(474,1,'2025-12-02 17:10:21.372',491217),(475,1,'2025-12-02 17:10:36.265',318753),(476,1,'2025-12-02 17:10:46.309',356884),(477,1,'2025-12-02 17:10:56.351',453025),(478,1,'2025-12-02 17:11:06.397',423310),(479,1,'2025-12-02 17:11:16.441',311962),(480,1,'2025-12-02 17:11:26.484',388688),(481,1,'2025-12-02 17:11:36.531',399456),(482,1,'2025-12-02 17:11:46.591',446006),(483,1,'2025-12-02 17:11:56.639',480060),(484,1,'2025-12-02 17:12:11.511',307449),(485,1,'2025-12-02 17:12:21.552',276620),(486,1,'2025-12-02 17:12:31.594',352991),(487,1,'2025-12-02 17:12:41.640',361934),(488,1,'2025-12-02 17:12:51.671',159968),(489,1,'2025-12-02 17:13:01.715',490655),(490,1,'2025-12-02 17:13:16.007',463089),(491,1,'2025-12-02 17:13:26.032',381335),(492,1,'2025-12-02 17:13:36.077',216707),(493,1,'2025-12-02 17:13:46.119',176128),(494,1,'2025-12-02 17:13:56.165',299841),(495,1,'2025-12-02 17:14:06.209',292432),(496,1,'2025-12-02 17:14:16.251',295435),(497,1,'2025-12-02 17:14:26.293',322841),(498,1,'2025-12-02 17:14:36.343',263733),(499,1,'2025-12-02 17:14:46.369',192712),(500,1,'2025-12-02 17:14:56.411',397269),(501,1,'2025-12-02 17:15:06.452',177700),(502,1,'2025-12-02 17:15:16.493',423448),(503,1,'2025-12-02 17:15:26.534',240977),(504,1,'2025-12-02 17:15:36.556',423388),(505,1,'2025-12-02 17:15:46.597',194074),(506,1,'2025-12-02 17:15:56.643',462297),(507,1,'2025-12-02 17:16:06.669',435107),(508,1,'2025-12-02 17:16:16.712',192965),(509,1,'2025-12-02 17:16:26.756',400289),(510,1,'2025-12-02 17:16:36.883',334164),(511,1,'2025-12-02 17:16:46.922',442833),(512,1,'2025-12-02 17:16:56.963',387180),(513,1,'2025-12-02 17:17:07.041',319946),(514,1,'2025-12-02 17:17:17.072',365884),(515,1,'2025-12-02 19:06:01.262',452436),(516,1,'2025-12-02 19:06:11.356',329948),(517,1,'2025-12-02 19:06:21.371',235914),(518,1,'2025-12-02 19:06:31.380',284231),(519,1,'2025-12-02 19:06:41.391',272840),(520,1,'2025-12-02 19:06:51.402',495703),(521,1,'2025-12-02 19:07:05.504',314097),(522,1,'2025-12-02 19:07:15.529',428198),(523,1,'2025-12-02 19:07:25.562',383658),(524,1,'2025-12-02 19:07:35.572',330600),(525,1,'2025-12-02 19:07:45.593',333248),(526,1,'2025-12-02 19:07:55.628',314690),(527,1,'2025-12-02 19:08:05.643',293499),(528,1,'2025-12-02 19:08:15.660',499901),(529,1,'2025-12-02 19:12:55.451',396019);
/*!40000 ALTER TABLE `lecturas` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `sucursales`
--

DROP TABLE IF EXISTS `sucursales`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `sucursales` (
  `id` int NOT NULL AUTO_INCREMENT,
  `nombre` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL,
  `direccion` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `ciudad` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `potencia_contratada_kw` decimal(10,2) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `nombre` (`nombre`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `sucursales`
--

LOCK TABLES `sucursales` WRITE;
/*!40000 ALTER TABLE `sucursales` DISABLE KEYS */;
INSERT INTO `sucursales` VALUES (1,'FN MUDAD','Los Nogales 1306','Tafí Viejo',500000.00);
/*!40000 ALTER TABLE `sucursales` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `usuarios`
--

DROP TABLE IF EXISTS `usuarios`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `usuarios` (
  `id` int NOT NULL AUTO_INCREMENT,
  `nombre_usuario` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL,
  `password_hash` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
  `nombre_completo` varchar(150) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `email` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `rol` enum('Admin','Gerente','Empleado') COLLATE utf8mb4_unicode_ci NOT NULL,
  `id_sucursal` int DEFAULT NULL,
  `reset_token` varchar(64) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `reset_token_expiration` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `nombre_usuario` (`nombre_usuario`),
  UNIQUE KEY `email` (`email`),
  KEY `id_sucursal` (`id_sucursal`),
  CONSTRAINT `usuarios_ibfk_1` FOREIGN KEY (`id_sucursal`) REFERENCES `sucursales` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `usuarios`
--

LOCK TABLES `usuarios` WRITE;
/*!40000 ALTER TABLE `usuarios` DISABLE KEYS */;
INSERT INTO `usuarios` VALUES (1,'admin','$2b$12$oW5GPJd496dTf41WXWB44.dj6Ra9RKahETP0t0Z2Oz6BDeqyr2Uve','anabella clessi','anaaclessi@gmail.com','Admin',NULL,NULL,NULL),(2,'empleado','$2b$12$IfU8YoxdZ05ljmy.JtIDc.iJNx4drFN984yoB5A0f6IQs.YjMsLZ6','anabella clessi','anaclessi@gmail.com','Empleado',NULL,NULL,NULL);
/*!40000 ALTER TABLE `usuarios` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_limit_roles_insert` BEFORE INSERT ON `usuarios` FOR EACH ROW BEGIN
    IF NEW.rol IN ('Admin', 'Gerente') THEN
        IF (SELECT COUNT(*) FROM usuarios WHERE rol = NEW.rol) >= 1 THEN
            SIGNAL SQLSTATE '45000' 
            SET MESSAGE_TEXT = 'Ya existe un usuario con ese rol';
        END IF;
    END IF;

    IF NEW.rol = 'Empleado' THEN
        IF (SELECT COUNT(*) FROM usuarios WHERE rol = 'Empleado') >= 10 THEN
            SIGNAL SQLSTATE '45000' 
            SET MESSAGE_TEXT = 'Solo puede haber 10 empleados';
        END IF;
    END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_0900_ai_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `trg_limit_roles_update` BEFORE UPDATE ON `usuarios` FOR EACH ROW BEGIN
    IF NEW.rol IN ('Admin', 'Gerente') THEN
        IF (SELECT COUNT(*) FROM usuarios WHERE rol = NEW.rol AND id <> OLD.id) >= 1 THEN
            SIGNAL SQLSTATE '45000' 
            SET MESSAGE_TEXT = 'Ya existe un usuario con ese rol';
        END IF;
    END IF;

    IF NEW.rol = 'Empleado' THEN
        IF (SELECT COUNT(*) FROM usuarios WHERE rol = 'Empleado' AND id <> OLD.id) >= 10 THEN
            SIGNAL SQLSTATE '45000' 
            SET MESSAGE_TEXT = 'Solo puede haber 10 empleados';
        END IF;
    END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Dumping events for database 'energia_db'
--

--
-- Dumping routines for database 'energia_db'
--
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2025-12-10 16:58:42
